function getChannelInfo(e){$.getJSON(serverURL+params.channelID+"/feeds.json?results=0&api_key="+params.api_key,e).fail(function(){alert("Invalid parametors")})}function initData(e){console.log("Loading..."),$.each(channel.list,function(e,a){var t=config,n=serverURL+params.channelID+"/field/"+a+".json?"+$.param(t);$.getJSON(n,function(t){var n=[];t.feeds&&$.each(t.feeds,function(e,t){if(t[fieldTxt+a]){var l=parseDataLog({datetime:t.created_at,value:t[fieldTxt+a]});n.push([l.datetime,l.value])}}),channel.data[a].last_entry_id=t.channel.last_entry_id,channel.data[a].updated_at=t.channel.updated_at,channel.updated_at=t.channel.updated_at,isLoading[a]=!1,seriesOptions[e]={name:channel.data[a].name,data:n,type:validTypes.indexOf(channel.data[a].type)>-1?channel.data[a].type:"line",step:"step"==channel.data[a].type?"left":!1},seriesCounter+=1,seriesCounter===channel.names.length&&createChart()})})}function getUrlParameter(e){for(var a=window.location.search.substring(1),t=a.split("&"),n={},l=0;l<t.length;l++){var i=t[l].split("=");if(n[i[0]]=i[1],i[0]==e)return i[1]}return n}function validateParams(){var e=getUrlParameter();return!Number(e.channelID)||Number(e.channelID)<1?(alert("Invalid Channel ID"),!1):e.api_key&&16!=e.api_key.length?(alert("Invalid Read API Key"),!1):(!1 in e&&(e.api_key=""),"results"in e&&Number(e.results)&&(config.results=Number(e.results)),"days"in e&&Number(e.days)&&(config.days=Number(e.days),delete config.results),config.dynamic="dynamic"in e&&"true"==e.dynamic,!0)}function getLogNames(e){var a=[];if(e.channel)for(var t=1;8>=t&&fieldTxt+t in e.channel;t++)channel.names.push(fieldTxt+t+":"+e.channel[fieldTxt+t]);return a}function setFields(e){params.types=decodeURIComponent(params.types).split(","),params.fields&&(params.fields=decodeURIComponent(params.fields).split(",")),console.log(params.fields),channel.list=[];var a=0;if(e.channel)for(var t=1;8>=t&&fieldTxt+t in e.channel;t++)(params.fields&&params.fields.indexOf(fieldTxt+t)>-1||!params.fields)&&(channel.data[t]={i:t,field:fieldTxt+t,label:e.channel[fieldTxt+t],name:fieldTxt+t+":"+e.channel[fieldTxt+t],type:a in params.types?params.types[a]:""},channel.fields.push(fieldTxt+t),channel.list.push(t),channel.names.push(fieldTxt+t+":"+e.channel[fieldTxt+t]),a++)}function getLogNameFromUrl(){return getUrlParameter("name").split(",")}function getReduce(){return"true"==getUrlParameter("average")}function parseDataLog(e){var a=new Date(e.datetime),t=a-1*a.getTimezoneOffset()*60*1e3;return e.datetime=t,e.value=Number(e.value),e}function handleLoaded(e){config.dynamic&&setInterval(function(){var a={results:config.results,api_key:params.api_key,start:channel.updated_at},t=serverURL+params.channelID+"/feeds.json?"+$.param(a);$.getJSON(t,function(a){a.feeds&&$.each(a.feeds,function(t,n){$.each(channel.list,function(t,l){if(n.entry_id>channel.data[l].last_entry_id&&n[fieldTxt+l]){var i=parseDataLog({datetime:n.created_at,value:n[fieldTxt+l]});e[t].addPoint([i.datetime,i.value],!0,!0),channel.data[l].last_entry_id=n.entry_id}channel.data[l].updated_at=a.channel.updated_at,channel.updated_at=a.channel.updated_at})})})},5e3)}var serverURL="https://data.learninginventions.org/channels/",config={results:1e3,dynamic:!1},fieldTxt="field",params={},channel={fields:[],names:[],data:{}},validTypes=["line","column","spline"],isLoading={},seriesOptions=[],seriesCounter=0,createChart=function(){Number(getUrlParameter("channelID"));$("#container").highcharts("StockChart",{chart:{events:{load:function(){var e=this.series.slice(0,this.series.length-1);handleLoaded(e)}}},title:{text:channel.name},rangeSelector:{buttons:[{type:"minute",count:5,text:"5min"},{type:"hour",count:1,text:"1hr"},{type:"day",count:1,text:"1d"},{type:"week",count:1,text:"1w"},{type:"month",count:1,text:"1m"},{type:"ytd",text:"YTD"},{type:"year",count:1,text:"1y"},{type:"all",text:"All"}]},yAxis:{plotLines:[{value:0,width:2,color:"silver"}]},legend:{enabled:!0,layout:"vertical",align:"right",verticalAlign:"middle",borderWidth:0},plotOptions:{bar:{dataLabels:{enabled:!0}}},tooltip:{pointFormat:'<span style="color:{series.color}">{series.name}</span>: <b>{point.y}</b><br/>',valueDecimals:2},series:seriesOptions})},updateChannelShow=function(e){channel=$.extend(channel,e.channel),setFields(e),initData(e)},updateChannelMultiShow=function(e){channel=$.extend(channel,e.channel),setFields(e);var a=$('<iframe src="show.html" width="100%" height="400px" style="border: 0px"></iframe>'),t=params;delete t.types,delete t.fields;for(fieldi in channel.data){var n=channel.data[fieldi],l=$(a).clone(),i="show.html?"+$.param($.extend(t,{fields:n.field,types:n.type}));l.attr("src",i),$("#container").append(l)}};